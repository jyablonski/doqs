---
title: ML Pipeline
description: A reference page in my new Starlight docs site.
lastUpdated: 2025-08-01
---

The ML Pipeline is a Python Service which generates win predictions for upcoming NBA games

---

## Architecture

### Database Usage
``` mermaid
graph LR
    subgraph PostgresDB[Postgres]
        T1[ml_tonights_games]
        T2[ml_game_predictions]
    end

    T1 -->|Fetches upcoming games| ML[ML Pipeline]
    ML -->|Stores win predictions| T2

    T2 --> API[REST API Service]
    T2 --> DASH[Dash Frontend Service]

    style PostgresDB fill:#89888f,stroke:#444444,stroke-width:2px
    style ML fill:#d6d6d6,stroke:#444444,stroke-width:1.5px
    style API fill:#f5f5f5,stroke:#444444,stroke-width:1.5px
    style DASH fill:#f5f5f5,stroke:#444444,stroke-width:1.5px


```

### ELT Pipeline Orchestration
``` mermaid
graph LR
    A[Ingestion Script] --> B[dbt]
    B --> C[ML Pipeline]
```
---

## How It Works

The ML model is a Logistic Regression classifier trained on data from the 2023-24 season.

- In production, the model achieves around 70-75% accuracy on win predictions.
- The trained model is serialized using `joblib` and stored directly into the container image that runs in production.

> _Note:_  
For more dynamic use cases, the model could be stored in S3 and pulled at runtime. This would allow the pipeline to load updated versions without requiring a container rebuild.

It pulls upcoming games from the `ml_models.ml_tonights_games` table generated by dbt, uses the ML model to build the predictions for each upcoming game, and then saves the results back to `ml_models.ml_game_predictions`.

- The downstream services pull the latest available data to present to end users
- Model accuracy is tracked by comparing the prediction results to the actual game results after the games are played

### Features Used

The following features are pulled for each home & away team in the upcoming games:

1. **Days of Rest** - Measures how many days of rest the team has had before the game.
   
2. **Top Players** - Ordinal ranking (0, 1, 2) which represents whether the team's top players are active or unavailable for the game

3. **Moneyline Odds** - Moneyline odds for the team for the upcoming game

3. **Recent Team Performance** - Team Win % for the last 10 games

4. **Overall Team Performance** - Team Win % for the entire season thus far



## Libraries

1. scikit-learn is the primary package behind building the ML Model & creating predictions
2. jyablonski_common_modules provides various functions to read & write data to Postgres

## Production

The ML Pipeline runs as an ECS Task following the completion of the dbt job.

- The ML Pipeline typically takes about ~10 seconds to complete

The NBA ELT Pipeline is fully complete after the ML Pipeline finishes, and there are no further tasks that get ran.

## CI / CD

For continuous integration (CI), the entire test suite is run on every commit in a pull request using Docker.

After a PR is merged, the continuous deployment (CD) pipeline performs the following steps:

1. Builds the Docker Image for the service which has the updated source code & dependencies
2. Pushes the Docker Image to ECR

On the next subsequent NBA ELT Pipeline run, this new Docker Image will be used when the ML Pipeline is scheduled to be ran in ECS